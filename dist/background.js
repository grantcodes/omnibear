(function(t){function e(o){if(r[o])return r[o].exports;var n=r[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=19)})([,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.openLink=function(t){t.preventDefault(),t.target.href&&chrome.tabs.create({url:t.target.href})},e.clone=function(t){return JSON.parse(JSON.stringify(t))},e.getAuthTab=function(){return new Promise(function(t,e){chrome.tabs.query({url:"https://omnibear.com/auth/success*"},function(r){r.length?t(r[0]):e("Auth tab not found")})})},e.logout=function(){["token","domain","authEndpoint","tokenEndpoint","micropubEndpoint"].map(function(t){return localStorage.removeItem(t)})}},function(t,e,r){"use strict";var o=String.prototype.replace,n=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(t){return o.call(t,n,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(t,e,r){"use strict";var o=Object.prototype.hasOwnProperty,n=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}();e.arrayToObject=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},o=0;o<t.length;++o)void 0!==t[o]&&(r[o]=t[o]);return r},e.merge=function(t,r,n){if(!r)return t;if("object"!=typeof r){if(Array.isArray(t))t.push(r);else{if("object"!=typeof t)return[t,r];(n.plainObjects||n.allowPrototypes||!o.call(Object.prototype,r))&&(t[r]=!0)}return t}if("object"!=typeof t)return[t].concat(r);var i=t;return Array.isArray(t)&&!Array.isArray(r)&&(i=e.arrayToObject(t,n)),Array.isArray(t)&&Array.isArray(r)?(r.forEach(function(r,i){o.call(t,i)?t[i]&&"object"==typeof t[i]?t[i]=e.merge(t[i],r,n):t.push(r):t[i]=r}),t):Object.keys(r).reduce(function(t,i){var s=r[i];return o.call(t,i)?t[i]=e.merge(t[i],s,n):t[i]=s,t},i)},e.assign=function(t,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},t)},e.decode=function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},e.encode=function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),r="",o=0;o<e.length;++o){var i=e.charCodeAt(o);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=e.charAt(o):i<128?r+=n[i]:i<2048?r+=n[192|i>>6]+n[128|63&i]:i<55296||i>=57344?r+=n[224|i>>12]+n[128|i>>6&63]+n[128|63&i]:(o+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(o)),r+=n[240|i>>18]+n[128|i>>12&63]+n[128|i>>6&63]+n[128|63&i])}return r},e.compact=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],o=0;o<e.length;++o)for(var n=e[o],i=n.obj[n.prop],s=Object.keys(i),a=0;a<s.length;++a){var c=s[a],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:i,prop:c}),r.push(u))}return function(t){for(var e;t.length;){var r=t.pop();if(e=r.obj[r.prop],Array.isArray(e)){for(var o=[],n=0;n<e.length;++n)void 0!==e[n]&&o.push(e[n]);r.obj[r.prop]=o}}return e}(e)},e.isRegExp=function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},e.isBuffer=function(t){return null!==t&&void 0!==t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){return t&&t.__esModule?t:{default:t}}(r(14));e.default=new o.default({clientId:"https://omnibear.com",redirectUri:"https://omnibear.com/auth/success/",state:"very-secret-omnibear-state",me:localStorage.getItem("domain"),authEndpoint:localStorage.getItem("authEndpoint"),tokenEndpoint:localStorage.getItem("tokenEndpoint"),micropubEndpoint:localStorage.getItem("micropubEndpoint"),token:localStorage.getItem("token")})},,,function(t,e,r){"use strict";var o=r(9),n=r(8),i=r(2);t.exports={formats:i,parse:n,stringify:o}},function(t,e,r){"use strict";var o=r(3),n=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:o.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1};t.exports=function(t,e){var r=e?o.assign({},e):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||o.isRegExp(r.delimiter)?r.delimiter:i.delimiter,r.depth="number"==typeof r.depth?r.depth:i.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:i.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:i.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:i.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:i.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:i.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:i.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:i.strictNullHandling,""===t||null===t||void 0===t)return r.plainObjects?Object.create(null):{};for(var s="string"==typeof t?function(t,e){for(var r={},o=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,a=o.split(e.delimiter,s),c=0;c<a.length;++c){var u,l,p=a[c],d=p.indexOf("]="),f=-1===d?p.indexOf("="):d+1;-1===f?(u=e.decoder(p,i.decoder),l=e.strictNullHandling?null:""):(u=e.decoder(p.slice(0,f),i.decoder),l=e.decoder(p.slice(f+1),i.decoder)),n.call(r,u)?r[u]=[].concat(r[u]).concat(l):r[u]=l}return r}(t,r):t,a=r.plainObjects?Object.create(null):{},c=Object.keys(s),u=0;u<c.length;++u){var l=c[u],p=function(t,e,r){if(t){var o=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(o),a=s?o.slice(0,s.index):o,c=[];if(a){if(!r.plainObjects&&n.call(Object.prototype,a)&&!r.allowPrototypes)return;c.push(a)}for(var u=0;null!==(s=i.exec(o))&&u<r.depth;){if(u+=1,!r.plainObjects&&n.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+o.slice(s.index)+"]"),function(t,e,r){for(var o=e,n=t.length-1;n>=0;--n){var i,s=t[n];if("[]"===s)i=(i=[]).concat(o);else{i=r.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,c=parseInt(a,10);!isNaN(c)&&s!==a&&String(c)===a&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=o:i[a]=o}o=i}return o}(c,e,r)}}(l,s[l],r);a=o.merge(a,p,r)}return o.compact(a)}},function(t,e,r){"use strict";var o=r(3),n=r(2),i={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},s=Date.prototype.toISOString,a={delimiter:"&",encode:!0,encoder:o.encode,encodeValuesOnly:!1,serializeDate:function(t){return s.call(t)},skipNulls:!1,strictNullHandling:!1};t.exports=function(t,e){var r=t,s=e?o.assign({},e):{};if(null!==s.encoder&&void 0!==s.encoder&&"function"!=typeof s.encoder)throw new TypeError("Encoder has to be a function.");var c=void 0===s.delimiter?a.delimiter:s.delimiter,u="boolean"==typeof s.strictNullHandling?s.strictNullHandling:a.strictNullHandling,l="boolean"==typeof s.skipNulls?s.skipNulls:a.skipNulls,p="boolean"==typeof s.encode?s.encode:a.encode,d="function"==typeof s.encoder?s.encoder:a.encoder,f="function"==typeof s.sort?s.sort:null,h=void 0!==s.allowDots&&s.allowDots,m="function"==typeof s.serializeDate?s.serializeDate:a.serializeDate,g="boolean"==typeof s.encodeValuesOnly?s.encodeValuesOnly:a.encodeValuesOnly;if(void 0===s.format)s.format=n.default;else if(!Object.prototype.hasOwnProperty.call(n.formatters,s.format))throw new TypeError("Unknown format option provided.");var y,b,v=n.formatters[s.format];"function"==typeof s.filter?r=(b=s.filter)("",r):Array.isArray(s.filter)&&(y=b=s.filter);var w=[];if("object"!=typeof r||null===r)return"";var k;k=s.arrayFormat in i?s.arrayFormat:"indices"in s?s.indices?"indices":"repeat":"indices";var j=i[k];y||(y=Object.keys(r)),f&&y.sort(f);for(var O=0;O<y.length;++O){var E=y[O];l&&null===r[E]||(w=w.concat(function t(e,r,n,i,s,c,u,l,p,d,f,h){var m=e;if("function"==typeof u)m=u(r,m);else if(m instanceof Date)m=d(m);else if(null===m){if(i)return c&&!h?c(r,a.encoder):r;m=""}if("string"==typeof m||"number"==typeof m||"boolean"==typeof m||o.isBuffer(m))return c?[f(h?r:c(r,a.encoder))+"="+f(c(m,a.encoder))]:[f(r)+"="+f(String(m))];var g=[];if(void 0===m)return g;var y;if(Array.isArray(u))y=u;else{var b=Object.keys(m);y=l?b.sort(l):b}for(var v=0;v<y.length;++v){var w=y[v];s&&null===m[w]||(g=Array.isArray(m)?g.concat(t(m[w],n(r,w),n,i,s,c,u,l,p,d,f,h)):g.concat(t(m[w],r+(p?"."+w:"["+w+"]"),n,i,s,c,u,l,p,d,f,h)))}return g}(r[E],E,j,u,l,p?d:null,b,f,h,m,v,g)))}var A=w.join(c),x=!0===s.addQueryPrefix?"?":"";return A.length>0?x+A:""}},function(t,e,r){"use strict";var o=r(7);r.n(o);r.o(o,"parse")&&r.d(e,"a",function(){return o.parse}),r.o(o,"stringify")&&r.d(e,"c",function(){return o.stringify});var n=r(13);r.d(e,"b",function(){return n.a});var i=r(12);r.d(e,"d",function(){return i.a});var s=r(11);r.d(e,"e",function(){return s.a})},function(t,e,r){"use strict";e.a=function(t,e){const r=-1==t.indexOf("?")?"?":"&";let o=[];for(var n in e)Array.isArray(e[n])?e[n].forEach(t=>{o.push(n+"[]="+encodeURIComponent(t))}):o.push(n+"="+encodeURIComponent(e[n]));return t+r+o.join("&")}},function(t,e,r){"use strict";function o(t,e=new FormData,r=!1){return Object.keys(t).forEach(n=>{const i=t[n];r&&(n=r+"["+n+"]"),Array.isArray(i)?e=o(i,e,n):e.append(n,i)}),e}e.a=o},function(t,e,r){"use strict";e.a=function(t,e){let r={},o=e;const n=(new DOMParser).parseFromString(t,"text/html"),i=n.querySelector("base[href]"),s=n.querySelectorAll("[rel][href]");if(i){const t=i.getAttribute("href"),e=new URL(t,e);o=e.toString()}return s.length&&s.forEach(t=>{const e=t.getAttribute("rel").toLowerCase().split("\\s+"),n=t.getAttribute("href");e.length&&null!==n&&e.forEach(t=>{r[t]||(r[t]=[]);const e=new URL(n,o).toString();-1===r[t].indexOf(e)&&r[t].push(e)})}),r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var o=r(10);const n=o.a,i=o.b,s=o.c,a=o.d,c=o.e;o.FormData&&!t.FormData&&(t.FormData=o.FormData),o.DOMParser&&!t.DOMParser&&(t.DOMParser=o.DOMParser),o.URL&&!t.URL&&(t.URL=o.URL);const u={me:"",scope:"post create delete update",token:"",authEndpoint:"",tokenEndpoint:"",micropubEndpoint:""},l=(t,e=null,r=null)=>({message:t,status:e,error:r});class p{constructor(t={}){this.options=Object.assign(u,t),this.create=this.create.bind(this),this.update=this.update.bind(this),this.delete=this.delete.bind(this),this.undelete=this.undelete.bind(this),this.postMicropub=this.postMicropub.bind(this),this.checkRequiredOptions=this.checkRequiredOptions.bind(this),this.getAuthUrl=this.getAuthUrl.bind(this),this.getEndpointsFromUrl=this.getEndpointsFromUrl.bind(this)}checkRequiredOptions(t){let e=[],r=!0;for(var o=0;o<t.length;o++){const n=t[o];this.options[n]||(r=!1,e.push(n))}return{pass:r,missing:e}}getEndpointsFromUrl(t){return new Promise((e,r)=>{let o={micropub:null,authorization_endpoint:null,token_endpoint:null},n=t;fetch(t).then(t=>{if(!t.ok)return r(l("Error getting page",t.status));n=t.url;const e=t.headers.get("link");if(e){e.split(",").forEach(t=>{Object.keys(o).forEach(e=>{const r=t.match(/rel=("([^"]*)"|([^,"<]+))/);if(r&&r[1]&&r[1].indexOf(e)>=0){const r=t.match(/[^<>|\s]+/g);r&&r[0]&&(o[e]=r[0])}})})}return t.text()}).then(s=>{const a=i(s,n);return this.options.me=t,a&&Object.keys(o).forEach(t=>{a[t]&&a[t][0]&&(o[t]=a[t][0])}),o.micropub&&o.authorization_endpoint&&o.token_endpoint?(this.options.micropubEndpoint=o.micropub,this.options.tokenEndpoint=o.token_endpoint,this.options.authEndpoint=o.authorization_endpoint,e({auth:this.options.authEndpoint,token:this.options.tokenEndpoint,micropub:this.options.micropubEndpoint})):r(l("Error getting microformats data"))}).catch(t=>r(l("Error fetching url",null,t)))})}getToken(t){return new Promise((e,r)=>{const o=this.checkRequiredOptions(["me","state","scope","clientId","redirectUri","tokenEndpoint"]);if(!o.pass)return r(l("Missing required options: "+o.missing.join(", ")));const i={grant_type:"authorization_code",state:this.options.state,me:this.options.me,code:t,scope:this.options.scope,state:this.options.state,client_id:this.options.clientId,redirect_uri:this.options.redirectUri},a={method:"POST",body:s(i),headers:new Headers({"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"})};fetch(this.options.tokenEndpoint,a).then(t=>{if(!t.ok)return r(l("Error getting token",t.status));const e=t.headers.get("Content-Type");return e&&0===e.indexOf("application/json")?t.json():t.text()}).then(t=>("string"==typeof t&&(t=n(t)),t.error_description?r(l(t.error_description)):t.error?r(l(t.error)):t.me&&t.scope&&t.access_token?t.me&&t.me.replace(/\/+$/,"")!==this.options.me.replace(/\/+$/,"")?r(l("The me values did not match")):(this.options.token=t.access_token,void e(t.access_token)):r(l("The token endpoint did not return the expected parameters")))).catch(t=>r(l("Error requesting token endpoint",null,t)))})}getAuthUrl(){return new Promise((t,e)=>{let r=this.checkRequiredOptions(["me","state"]);if(!r.pass)return e(l("Missing required options: "+r.missing.join(", ")));this.getEndpointsFromUrl(this.options.me).then(()=>{let r=this.checkRequiredOptions(["me","state","scope","clientId","redirectUri"]);if(!r.pass)return e(l("Missing required options: "+r.missing.join(", ")));const o={me:this.options.me,client_id:this.options.clientId,redirect_uri:this.options.redirectUri,response_type:"code",scope:this.options.scope,state:this.options.state};t(this.options.authEndpoint+"?"+s(o))}).catch(t=>e(l("Error getting auth url",null,t)))})}verifyToken(){return new Promise((t,e)=>{const r=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!r.pass)return e(l("Missing required options: "+r.missing.join(", ")));const o={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token})};fetch(this.options.micropubEndpoint,o).then(r=>r.ok?t(!0):e(l("Error verifying token",r.status))).catch(t=>e(l("Error verifying token",null,t)))})}create(t,e="json"){return this.postMicropub(t,e)}update(t,e){return this.postMicropub(Object.assign({action:"update",url:t},e))}delete(t){return this.postMicropub({action:"delete",url:t})}undelete(t){return this.postMicropub({action:"undelete",url:t})}postMicropub(t,e="json"){return new Promise((r,o)=>{const i=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!i.pass)return o(l("Missing required options: "+i.missing.join(", ")));let c={method:"POST"};"json"==e?(c.body=JSON.stringify(t),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/json",Accept:"application/json, application/x-www-form-urlencoded"})):"form"==e?(c.body=s(t),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"})):"multipart"==e&&(c.body=a(t),c.headers=new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":void 0,Accept:"application/json, application/x-www-form-urlencoded"})),fetch(this.options.micropubEndpoint,c).then(t=>{if(!t.ok)return o(l("Error with micropub request",t.status));const e=t.headers.get("Location")||t.headers.get("location");if(e)return r(e);const n=t.headers.get("Content-Type");return n&&0===n.indexOf("application/json")?t.json():t.text()}).then(t=>("string"==typeof t&&(t=n(t)),t.error_description?o(l(t.error_description)):t.error?o(l(t.error)):r(t))).catch(t=>o(l("Error sending request",null,t)))})}postMedia(t){return new Promise((e,r)=>{const o=this.checkRequiredOptions(["token","mediaEndpoint"]);if(!o.pass)return r(l("Missing required options: "+o.missing.join(", ")));let n={method:"POST",body:a({file:t}),headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":void 0,Accept:"*/*"})};fetch(this.options.mediaEndpoint,n).then(t=>{if(201!==t.status)return r(l("Error creating media",t.status));const o=t.headers.get("Location")||t.headers.get("location");return o?e(o):r(l("Media endpoint did not return a location",t.status))}).catch(t=>r(l("Error sending request")))})}query(t){return new Promise((e,r)=>{const o=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!o.pass)return r(l("Missing required options: "+o.missing.join(", ")));const n=c(this.options.micropubEndpoint,{q:t}),i={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"})};fetch(n,i).then(e=>e.ok?e.json():r(l("Error getting "+t,e.status))).then(t=>e(t)).catch(e=>r(l("Error getting "+t,null,e)))})}querySource(t,e=[]){return new Promise((r,o)=>{const n=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!n.pass)return o(l("Missing required options: "+n.missing.join(", ")));t=c(this.options.micropubEndpoint,{q:"source",url:t,properties:e});const i={method:"GET",headers:new Headers({Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"})};fetch(t,i).then(t=>t.ok?t.json():o(l("Error getting source",t.status))).then(t=>r(t)).catch(t=>o(l("Error getting source",null,t)))})}}e.default=p}.call(e,r(15))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},,,function(t,e,r){"use strict";function o(t,e){var r=e.split("&").filter(function(e){return e.startsWith(t+"=")});if(r&&r.length){var o=r[0].substr(t.length+1);return decodeURIComponent(o)}return null}function n(t){var e={};for(var r in t)r.startsWith("utm_")||(e[r]=t[r]);return e}function i(t){var e=[];for(var r in t)e.push(r+"="+t[r]);return e.length?"?"+e.join("&"):""}Object.defineProperty(e,"__esModule",{value:!0}),e.getParamFromUrl=function(t,e){return o(t,e.split("?")[1])},e.getParamFromUrlString=o,e.cleanParams=n,e.paramsToQueryString=i,e.getUrlOrigin=function(t){var e=(0,s.default)(t);return[e.protocol,"://",e.host,e.port?":"+e.port:""].join("")},e.cleanUrl=function(t){var e=(0,s.default)(t);return[e.protocol,"://",e.host,e.port?":"+e.port:"",e.path,i(n(e.queryKey))].join("")};var s=function(t){return t&&t.__esModule?t:{default:t}}(r(31))},function(t,e,r){"use strict";function o(t){localStorage.setItem("selectedEntry",t)}function n(){localStorage.removeItem("selectedEntry")}var i=function(t){return t&&t.__esModule?t:{default:t}}(r(4)),s=r(18),a=r(1),c=null;chrome.runtime.onMessage.addListener(function(t,e,r){switch(t.action){case"begin-auth":(function(t){localStorage.setItem("domain",t.domain),localStorage.setItem("authEndpoint",t.metadata.authEndpoint),localStorage.setItem("tokenEndpoint",t.metadata.tokenEndpoint),localStorage.setItem("micropubEndpoint",t.metadata.micropub),chrome.tabs.create({url:t.authUrl},function(t){c=t.id})})(t.payload);break;case"focus-window":(function(t,e){localStorage.setItem("pageUrl",(0,s.cleanUrl)(t)),e?o(e):n()})(e.url,t.payload.selectedEntry);break;case"select-entry":o(t.payload.url);break;case"clear-entry":n()}}),chrome.tabs.onUpdated.addListener(function(t,e,r){if(t===c&&function(t){return t.url&&t.url.startsWith("https://omnibear.com/auth/success")}(e)){var o=(0,s.getParamFromUrl)("code",e.url),n=(0,s.getParamFromUrl)("me",e.url);if(n){var u=localStorage.getItem("domain");(0,s.getUrlOrigin)(u)!==(0,s.getUrlOrigin)(n)&&(chrome.tabs.sendMessage(r.id,{action:"fetch-token-error",payload:{error:new Error("'me' url domain doesn't match auth endpoint domain")}}),(0,a.logout)()),localStorage.setItem("domain",n)}i.default.options.me=localStorage.getItem("domain"),i.default.options.tokenEndpoint=localStorage.getItem("tokenEndpoint"),i.default.getToken(o).then(function(t){if(!t)throw new Error("Token not found in token endpoint response. Missing expected field 'access_token'");localStorage.setItem("token",t),chrome.tabs.remove(r.id),c=null}).catch(function(t){(0,a.getAuthTab)().then(function(e){chrome.tabs.sendMessage(e.id,{action:"fetch-token-error",payload:{error:t}}),(0,a.logout)()})})}}),chrome.contextMenus.create({title:"Reply to entry",contexts:["page","selection"],onclick:function(){"undefined"==typeof browser?window.open("index.html?reply=true","extension_popup","width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000"):browser.windows.create({url:"index.html?reply=true",width:450,height:510,type:"panel",left:2e3})}})},,,,,,,,,,,,function(t,e,r){"use strict";t.exports=function(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},o=r.parser[e.strictMode?"strict":"loose"].exec(t),n={},i=14;i--;)n[r.key[i]]=o[i]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(t,e,o){e&&(n[r.q.name][e]=o)}),n}}]);